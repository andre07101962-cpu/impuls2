# üìò Impulse Frontend: Publisher & Scheduler Architecture

**Version:** 1.0
**Author:** Backend Team
**Module:** Publisher (Content Creation)

---

## 1. –ö–æ–Ω—Ü–µ–ø—Ü–∏—è: "One Post, Many Destinations"

–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É —Ä–∞—Å—Å—ã–ª–∫–∏.
1.  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç **–æ–¥–∏–Ω** –æ–±—ä–µ–∫—Ç –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (`content`).
2.  –í—ã–±–∏—Ä–∞–µ—Ç **–º–∞—Å—Å–∏–≤** –∫–∞–Ω–∞–ª–æ–≤ (`channelIds`).
3.  –°–µ—Ä–≤–µ—Ä —Å–æ–∑–¥–∞–µ—Ç **N** –∑–∞–¥–∞—á (`ScheduledPublication`), –∫–æ—Ç–æ—Ä—ã–µ –∂–∏–≤—É—Ç —Å–≤–æ–µ–π –∂–∏–∑–Ω—å—é.

### –û—Å–Ω–æ–≤–Ω—ã–µ –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã
*   `POST /publisher/schedule` ‚Äî –°–æ–∑–¥–∞—Ç—å –∏ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å.
*   `PATCH /publisher/schedule/:id` ‚Äî –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å (–æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ –∏–ª–∏ –∂–∏–≤–æ–µ).
*   `DELETE /publisher/:id` ‚Äî –£–¥–∞–ª–∏—Ç—å (–æ—Ç–º–µ–Ω—è–µ—Ç —Ç–∞–π–º–µ—Ä –∏–ª–∏ —É–¥–∞–ª—è–µ—Ç –∏–∑ Telegram).
*   `GET /publisher/publications` ‚Äî –î–∞–Ω–Ω—ã–µ –¥–ª—è –ö–∞–ª–µ–Ω–¥–∞—Ä—è.

---

## 2. –¢–∏–ø—ã –ü–æ—Å—Ç–æ–≤ (Post Types)

Frontend –¥–æ–ª–∂–µ–Ω —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å **Tabs / Switcher** –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–∏–ø–∞ –ø–æ—Å—Ç–∞. –û—Ç —Ç–∏–ø–∞ –∑–∞–≤–∏—Å–∏—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã.

### Enum
```typescript
enum PostType {
  POST = 'post',             // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π (–¢–µ–∫—Å—Ç, –§–æ—Ç–æ, –í–∏–¥–µ–æ, –ê–ª—å–±–æ–º)
  STORY = 'story',           // Telegram Story (9:16)
  PAID_MEDIA = 'paid_media', // –ü–ª–∞—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç (Stars)
  POLL = 'poll',             // –û–ø—Ä–æ—Å / –í–∏–∫—Ç–æ—Ä–∏–Ω–∞
  DOCUMENT = 'document',     // –§–∞–π–ª
}
```

---

## 3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Payload (–ß—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å)

–ü–æ–ª–µ `content` ‚Äî —ç—Ç–æ –≥–∏–±–∫–∏–π JSON –æ–±—ä–µ–∫—Ç.

### –ê. –û–±—ã—á–Ω—ã–π –ü–æ—Å—Ç (Default)
–°–∞–º—ã–π —á–∞—Å—Ç—ã–π –∫–µ–π—Å. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Markdown/HTML.

```json
{
  "type": "post",
  "publishAt": "2024-05-20T15:00:00Z",
  "channelIds": ["-100123..."],
  "content": {
    "text": "Hello <b>World</b>",
    "media": [
      "https://bucket.com/img1.jpg", 
      "https://bucket.com/video.mp4"
    ],
    "buttons": [ // Inline Keyboard (–ú–∞—Å—Å–∏–≤ –º–∞—Å—Å–∏–≤–æ–≤)
      [ { "text": "–ö—É–ø–∏—Ç—å", "url": "https://google.com" } ]
    ],
    "options": {
      "disable_notification": false, // Silent send
      "protect_content": true,       // –ó–∞–ø—Ä–µ—Ç –ø–µ—Ä–µ—Å—ã–ª–∫–∏
      "has_spoiler": true,           // –°–ø—Ä—è—Ç–∞—Ç—å –º–µ–¥–∏–∞
      "pin": true                    // –ó–∞–∫—Ä–µ–ø–∏—Ç—å –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
    }
  }
}
```
*   *–ê–ª—å–±–æ–º—ã:* –ï—Å–ª–∏ –≤ `media` > 1 —Å—Å—ã–ª–∫–∏, —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–ª—å–±–æ–º–æ–º.
*   *–§–∞–π–ª—ã:* –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞ CDN/S3, —Å—é–¥–∞ —à–ª–µ–º —Ç–æ–ª—å–∫–æ URL.

### –ë. –ò—Å—Ç–æ—Ä–∏–∏ (Stories)
‚ö†Ô∏è **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
1.  –¢–æ–ª—å–∫–æ –¥–ª—è –ö–∞–Ω–∞–ª–æ–≤ (–≤ –ì—Ä—É–ø–ø—ã/–¢–æ–ø–∏–∫–∏ –Ω–µ–ª—å–∑—è).
2.  –¢–æ–ª—å–∫–æ 1 —Ñ–∞–π–ª –º–µ–¥–∏–∞.

```json
{
  "type": "story",
  "content": {
    "media": "https://.../video_9_16.mp4",
    "text": "Caption text",
    "story_config": {
      "period": 86400 // –°—Ä–æ–∫ –∂–∏–∑–Ω–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (24—á)
    }
  }
}
```

### –í. –û–ø—Ä–æ—Å—ã (Polls)
```json
{
  "type": "poll",
  "content": {
    "question": "React vs Vue?",
    "poll_options": ["React", "Vue", "Svelte"], // –ú–∏–Ω–∏–º—É–º 2 –æ–ø—Ü–∏–∏
    "poll_config": {
      "is_anonymous": true,
      "allows_multiple_answers": false,
      "type": "quiz",           // –∏–ª–∏ "regular"
      "correct_option_id": 0    // –ò–Ω–¥–µ–∫—Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ (–µ—Å–ª–∏ quiz)
    }
  }
}
```

### –ì. –ü–ª–∞—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç (Paid Media)
–ù–æ–≤–∞—è —Ñ–∏—á–∞ Telegram Stars. –ö–æ–Ω—Ç–µ–Ω—Ç —Å–∫—Ä—ã—Ç –±–ª—é—Ä–æ–º.

```json
{
  "type": "paid_media",
  "content": {
    "text": "–ö—É–ø–∏—Ç–µ, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å",
    "media": ["https://..."],
    "paid_config": {
      "star_count": 50 // –¶–µ–Ω–∞ –≤ –∑–≤–µ–∑–¥–∞—Ö
    }
  }
}
```

---

## 4. –õ–æ–≥–∏–∫–∞ –¢–∞—Ä–≥–µ—Ç–∏–Ω–≥–∞ (–ö–∞–Ω–∞–ª—ã vs –§–æ—Ä—É–º—ã)

–≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –º–æ–º–µ–Ω—Ç UX.

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü—Ä–æ—Å—Ç–æ–π –ø–æ—Å—Ç–∏–Ω–≥
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±—Ä–∞–ª 3 –æ–±—ã—á–Ω—ã—Ö –∫–∞–Ω–∞–ª–∞.
*   –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –º–∞—Å—Å–∏–≤ `channelIds`.
*   –ü–æ–ª–µ `content.options.topic_id` **–Ω–µ –ø–µ—Ä–µ–¥–∞–µ–º**.

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ—Å—Ç–∏–Ω–≥ –≤ –¢–æ–ø–∏–∫ (Forum Topic)
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –Ω–∞–ø–∏—Å–∞—Ç—å –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –≤–µ—Ç–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, "General" –∏–ª–∏ "News").
1.  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç **–û–î–ò–ù** –∫–∞–Ω–∞–ª (–∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è —Ñ–æ—Ä—É–º–æ–º).
2.  –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ —Ç–æ–ø–∏–∫–æ–≤.
3.  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–æ–ø–∏–∫.
4.  **Payload:**
    ```json
    "channelIds": ["-100..."], // ID –ö–∞–Ω–∞–ª–∞-—Ä–æ–¥–∏—Ç–µ–ª—è
    "content": {
      "options": {
        "topic_id": 42 // ID –¢–æ–ø–∏–∫–∞ (message_thread_id)
      }
    }
    ```
*   **–í–∞–∂–Ω–æ:** –ù–µ–ª—å–∑—è –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–∞–Ω–∞–ª–æ–≤, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω `topic_id`. (–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ —Å–ª–æ–∂–Ω–æ —Å–º–∞–ø–∏—Ç—å —Ç–æ–ø–∏–∫–∏ —Ä–∞–∑–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤).
*   **UI –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞:** –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Ç–æ–ø–∏–∫, –º—É–ª—å—Ç–∏-—Å–µ–ª–µ–∫—Ç –∫–∞–Ω–∞–ª–æ–≤ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è.

---

## 5. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (Edit Flow)

–£ –Ω–∞—Å –µ—Å—Ç—å –¥–≤–∞ —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –ë—ç–∫–µ–Ω–¥ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏—Ö –ø–æ —Ñ–ª–∞–≥—É `isLiveEdit`.

### –†–µ–∂–∏–º –ê: "–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫" (Reschedule)
–ü–æ—Å—Ç –µ—â–µ –Ω–µ —É—à–µ–ª (`status: scheduled`).
*   –ú–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –≤—Å—ë: –≤—Ä–µ–º—è, –∫–∞—Ä—Ç–∏–Ω–∫–∏, —Ç–∏–ø –ø–æ—Å—Ç–∞.
*   –ó–∞–ø—Ä–æ—Å: `PATCH /publisher/schedule/:id`
*   Payload: –ö–∞–∫ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏.

### –†–µ–∂–∏–º –ë: "Live Edit" (–ñ–∏–≤–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
–ü–æ—Å—Ç —É–∂–µ –≤ Telegram (`status: published`). –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ–ø–µ—á–∞—Ç–∫—É.
*   Telegram API –∑–∞–ø—Ä–µ—â–∞–µ—Ç –º–µ–Ω—è—Ç—å —Ç–∏–ø –º–µ–¥–∏–∞ (–ö–∞—Ä—Ç–∏–Ω–∫—É –Ω–∞ –í–∏–¥–µ–æ) –∏–ª–∏ —É–¥–∞–ª—è—Ç—å –∫–Ω–æ–ø–∫–∏.
*   **–†–∞–∑—Ä–µ—à–µ–Ω–æ:** –ú–µ–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç (`content.text`).
*   **–§–ª–∞–≥:** –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å `isLiveEdit: true`.
*   **–¢–∞–π–º–µ—Ä:** –ú–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å `deleteAt` (–≤—Ä–µ–º—è —É–¥–∞–ª–µ–Ω–∏—è), –Ω–æ `publishAt` –±—É–¥–µ—Ç –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω.

```json
// –ü—Ä–∏–º–µ—Ä Live Edit
PATCH /publisher/schedule/:id
{
  "isLiveEdit": true,
  "content": {
    "text": "–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —Å <b>HTML</b>"
  }
}
```

---

## 6. –¢–∞–π–º–µ—Ä—ã (Scheduling & Auto-Delete)

–í —Ñ–æ—Ä–º–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥–≤–∞ DatePicker'–∞.

1.  **–î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ (`publishAt`):**
    *   –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ.
    *   –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç "–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å–µ–π—á–∞—Å", —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ —Å—Ç–∞–≤–∏—Ç `new Date().toISOString()`.

2.  **–î–∞—Ç–∞ —É–¥–∞–ª–µ–Ω–∏—è (`deleteAt`):**
    *   –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ (Self-Destruct).
    *   –í–∞–ª–∏–¥–∞—Ü–∏—è: `deleteAt > publishAt`.
    *   –ï—Å–ª–∏ –∑–∞–¥–∞–Ω–æ, —Å–µ—Ä–≤–µ—Ä —É–¥–∞–ª–∏—Ç –ø–æ—Å—Ç –∏–∑ Telegram –≤ —ç—Ç–æ –≤—Ä–µ–º—è.

---

## 7. –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∏ –¶–≤–µ—Ç–∞ –°—Ç–∞—Ç—É—Å–æ–≤

–ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–π (`GET /publisher/publications`), –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª–µ `status` –¥–ª—è —Ä–∞—Å–∫—Ä–∞—Å–∫–∏.

| –°—Ç–∞—Ç—É—Å | –¶–≤–µ—Ç (Tailwind) | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- | :--- |
| `scheduled` | `bg-blue-500` | –ñ–¥–µ—Ç —Ç–∞–π–º–µ—Ä–∞. –ú–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –≤—Å—ë. |
| `published` | `bg-green-500` | –£–∂–µ –≤ Telegram. –î–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ Live Edit (—Ç–µ–∫—Å—Ç). |
| `failed` | `bg-red-500` | –û—à–∏–±–∫–∞ (–§–ª—É–¥, –ë–æ—Ç –∑–∞–±–∞–Ω–µ–Ω, –§–æ—Ä–º–∞—Ç –Ω–µ–≤–µ—Ä–Ω—ã–π). |
| `deleted` | `bg-gray-500` | –ë—ã–ª –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω –∏ —É–¥–∞–ª–µ–Ω (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–ª–∏ –≤—Ä—É—á–Ω—É—é). |

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Ñ–æ—Ä–º—ã (CreatePostForm)

1.  [ ] **–ó–∞–≥—Ä—É–∑–∫–∞ –º–µ–¥–∏–∞:** –°–Ω–∞—á–∞–ª–∞ –≥—Ä—É–∑–∏–º —Ñ–∞–π–ª—ã –Ω–∞ S3/Cloudinary, –ø–æ–ª—É—á–∞–µ–º URL, –∫–ª–∞–¥–µ–º –≤ –º–∞—Å—Å–∏–≤ `content.media`.
2.  [ ] **–í–∞–ª–∏–¥–∞—Ü–∏—è –¢–æ–ø–∏–∫–æ–≤:** –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Ç–æ–ø–∏–∫, –æ—á–∏—Å—Ç–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–∞–Ω–∞–ª—ã –∏–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞.
3.  [ ] **–ö–Ω–æ–ø–∫–∞ "–ó–∞–∫—Ä–µ–ø–∏—Ç—å":** –ß–µ–∫–±–æ–∫—Å "Pin message" -> `content.options.pin = true`.
4.  [ ] **–ö–Ω–æ–ø–∫–∞ "–ë–µ–∑ –∑–≤—É–∫–∞":** –ß–µ–∫–±–æ–∫—Å "Silent" -> `content.options.disable_notification = true`.
5.  [ ] **–ü—Ä–µ–≤—å—é:** –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –∫–∞–∫ –ø—Ä–∏–º–µ—Ä–Ω–æ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –±–∞–±–±–ª —Å–æ–æ–±—â–µ–Ω–∏—è (—É—á–∏—Ç—ã–≤–∞—è HTML —Ç–µ–≥–∏).
